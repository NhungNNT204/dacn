# H·ªá Th·ªëng T∆∞∆°ng T√°c C·ªông ƒê·ªìng - UpNest Education

## üìã T·ªïng Quan

H·ªá th·ªëng t∆∞∆°ng t√°c c·ªông ƒë·ªìng ho√†n ch·ªânh cho n·ªÅn t·∫£ng UpNest Education cho ph√©p:

- **Reactions (Ph·∫£n ·ª©ng)**: 8 lo·∫°i emoji reaction (üëç‚ù§Ô∏èüòÇüòÆüò¢üò†üëèü§î)
- **Comments (B√¨nh lu·∫≠n)**: H·ªá th·ªëng b√¨nh lu·∫≠n v·ªõi nested replies (tr·∫£ l·ªùi l·ªìng nhau)
- **Media Sharing (Chia s·∫ª media)**: Upload h√¨nh ·∫£nh, video v·ªõi drag-drop UI
- **Teacher Controls (Ki·ªÉm so√°t gi√°o vi√™n)**: Ghim post, kh√≥a b√¨nh lu·∫≠n, x√≥a n·ªôi dung

---

## üèóÔ∏è Ki·∫øn Tr√∫c H·ªá Th·ªëng

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         AnnouncementFeedWithInteractions.jsx            ‚îÇ
‚îÇ              (Container Component)                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ       ‚îÇ                   ‚îÇ
       ‚ñº       ‚ñº                   ‚ñº
  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ Post    ‚îÇ ‚îÇComments ‚îÇ  ‚îÇPostInteract ‚îÇ
  ‚îÇReaction ‚îÇ ‚îÇ Section ‚îÇ  ‚îÇ    ion      ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ         ‚îÇ               ‚îÇ
       ‚îÇ         ‚îÇ               ‚îÇ
       ‚ñº         ‚ñº               ‚ñº
  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ     Hooks & Services Layer             ‚îÇ
  ‚îÇ  - usePostInteractions                 ‚îÇ
  ‚îÇ  - usePermissions                      ‚îÇ
  ‚îÇ  - postInteractionService              ‚îÇ
  ‚îÇ  - rolePermissions.js                  ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìÅ C·∫•u Tr√∫c File

```
upnest-web/src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ PostInteraction.jsx            # Reactions & like component
‚îÇ   ‚îú‚îÄ‚îÄ PostInteraction.css
‚îÇ   ‚îú‚îÄ‚îÄ CommentSection.jsx             # Comments with nested replies
‚îÇ   ‚îú‚îÄ‚îÄ CommentSection.css
‚îÇ   ‚îú‚îÄ‚îÄ MediaUpload.jsx                # Drag-drop file upload
‚îÇ   ‚îî‚îÄ‚îÄ MediaUpload.css
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îî‚îÄ‚îÄ usePostInteractions.js         # Custom hook for state management
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îî‚îÄ‚îÄ classroom/
‚îÇ       ‚îú‚îÄ‚îÄ AnnouncementFeedWithInteractions.jsx
‚îÇ       ‚îî‚îÄ‚îÄ AnnouncementFeedWithInteractions.css
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ postInteractionService.js      # API layer
‚îî‚îÄ‚îÄ utils/
    ‚îî‚îÄ‚îÄ rolePermissions.js             # Role-based access control
```

---

## üîß Components

### 1. PostInteraction Component

**V·ªã tr√≠**: `src/components/PostInteraction.jsx`

**Ch·ª©c nƒÉng**:
- Hi·ªÉn th·ªã reaction emoji picker
- N√∫t like nhanh
- N√∫t b√¨nh lu·∫≠n v√† chia s·∫ª
- Menu ki·ªÉm so√°t cho gi√°o vi√™n (ghim, kh√≥a, x√≥a)
- Hi·ªÉn th·ªã th·ªëng k√™ reactions

**Props**:
```javascript
{
  post: {                    // Object b√†i vi·∫øt
    id: string,
    reactions: {             // Object reactions theo lo·∫°i
      LIKE: [],              // Array user IDs
      LOVE: [],
      ...
    },
    userReaction: string,    // Reaction hi·ªán t·∫°i c·ªßa user
  },
  onReactionChange: (type, isRemoving) => {},
  onCommentClick: () => {},
  onShareClick: () => {},
  onDeletePost: () => {},
  isTeacher: boolean,
  canInteract: boolean,
  onTogglePin: () => {},
  onToggleLockComments: () => {},
}
```

**Reactions ƒê∆∞·ª£c H·ªó Tr·ª£**:
- üëç LIKE - Th√≠ch
- ‚ù§Ô∏è LOVE - Y√™u th√≠ch
- üòÇ HAHA - Haha
- üòÆ WOW - Wow
- üò¢ SAD - Bu·ªìn
- üò† ANGRY - T·ª©c gi·∫≠n
- üëè CLAP - V·ªó tay
- ü§î THINKING - Suy nghƒ©

---

### 2. CommentSection Component

**V·ªã tr√≠**: `src/components/CommentSection.jsx`

**Ch·ª©c nƒÉng**:
- Hi·ªÉn th·ªã danh s√°ch comments
- Th√™m comment m·ªõi
- Edit comment (owner ho·∫∑c teacher)
- X√≥a comment (owner ho·∫∑c teacher)
- Like comments
- Nested replies (tr·∫£ l·ªùi comment)
- Hi·ªÉn th·ªã th·ªùi gian edit

**Props**:
```javascript
{
  comments: [
    {
      id: string,
      author: { id, name, role, avatar },
      content: string,
      timestamp: Date,
      likes: [string],        // Array user IDs
      userLiked: boolean,
      replies: [],            // Array of reply objects
      mediaIds: [],
      isEdited: boolean,
      editedAt: Date,
    }
  ],
  onAddComment: (content, mediaIds) => {},
  onDeleteComment: (commentId) => {},
  onEditComment: (commentId, content) => {},
  onLikeComment: (commentId) => {},
  onAddReply: (commentId, content, mediaIds) => {},
  currentUserRole: 'TEACHER' | 'STUDENT' | 'ADMIN' | 'GUEST',
}
```

**Features**:
- Reply l·ªìng nhau v·ªõi indentation
- Inline edit form
- Permission-based controls
- File attachment support
- Timestamp with edit badge

---

### 3. MediaUpload Component

**V·ªã tr√≠**: `src/components/MediaUpload.jsx`

**Ch·ª©c nƒÉng**:
- Drag-drop file upload
- Click to browse
- File validation (type & size)
- Progress tracking per file
- File preview (image thumbnail, video placeholder)
- Multi-file support (default max 5)
- Error display

**Props**:
```javascript
{
  onMediaSelect: (files) => {},
  maxFiles: number,          // Default: 5
  maxFileSize: number,       // Default: 10MB
  allowedTypes: string[],    // MIME types
}
```

**Supported Formats**:
- Images: JPG, PNG, GIF
- Videos: MP4, WebM
- Default max size: 10MB per file

---

## ü™ù Hooks

### usePostInteractions

**V·ªã tr√≠**: `src/hooks/usePostInteractions.js`

**Ch·ª©c nƒÉng**: Qu·∫£n l√Ω state cho t·∫•t c·∫£ post interactions

**Methods**:
```javascript
const {
  // State
  reactions,                  // Object reactions
  comments,                   // Array comments
  userReaction,              // Current user reaction
  isLiked,                   // Is post liked
  totalReactions,            // Total reaction count
  
  // Methods
  toggleReaction,            // Toggle emoji reaction
  addComment,                // Add new comment
  deleteComment,             // Delete comment
  editComment,               // Edit comment content
  likeComment,               // Like/unlike comment
  addReply,                  // Add nested reply
  setError,                  // Set error message
} = usePostInteractions(postId);
```

---

## üîê Permission System

**V·ªã tr√≠**: `src/utils/rolePermissions.js`

**4 Roles ƒê∆∞·ª£c H·ªó Tr·ª£**:

1. **ADMIN**: T·∫•t c·∫£ permissions
2. **TEACHER**: T·∫°o, ch·ªânh s·ª≠a, x√≥a post/comment, ki·ªÉm duy·ªát, ghim, kh√≥a
3. **STUDENT**: T·∫°o post, like, b√¨nh lu·∫≠n, upload media; ch·ªânh s·ª≠a/x√≥a ch·ªâ n·ªôi dung c·ªßa m√¨nh
4. **GUEST**: Kh√¥ng c√≥ quy·ªÅn

**12 Permissions**:
- `CREATE_POST`
- `EDIT_POST`
- `DELETE_POST`
- `LIKE_POST`
- `COMMENT_POST`
- `EDIT_COMMENT`
- `DELETE_COMMENT`
- `SHARE_POST`
- `UPLOAD_MEDIA`
- `PIN_POST`
- `LOCK_COMMENTS`
- `MODERATE_COMMENTS`

**S·ª≠ d·ª•ng**:
```javascript
import { usePermissions } from '../utils/rolePermissions';

const { 
  canLike, 
  canComment, 
  canEditComment, 
  canDeleteComment,
  canPinPost,
  canLockComments,
  isTeacher,
  isAdmin,
} = usePermissions(userRole, userId);

if (canLike()) {
  // User can like
}
```

---

## üì° API Service

**V·ªã tr√≠**: `src/services/postInteractionService.js`

**Endpoints**:

```javascript
// Reactions
toggleReaction(postId, reactionType, userId)

// Comments
addComment(postId, commentData)
editComment(postId, commentId, updateData)
deleteComment(postId, commentId)
toggleCommentLike(postId, commentId, userId)

// Replies
addReply(postId, commentId, replyData)

// Media
uploadMedia(files, options)

// Teacher Controls
togglePinPost(postId, isPinned)
toggleLockComments(postId, isLocked)
toggleDisableInteractions(postId, disabled)
deletePost(postId)

// Queries
getPostDetails(postId)
getComments(postId, options)
getModerationQueue(filters)

// Moderation
moderateContent(contentId, action, reason)
```

---

## üé® Styling

### CSS Files

1. **PostInteraction.css** (~200 lines)
   - Reaction picker styling
   - Emoji button styles
   - Teacher menu
   - Responsive design

2. **CommentSection.css** (~350 lines)
   - Comment input form
   - Comments list
   - Nested replies
   - Edit/delete controls
   - Responsive design

3. **MediaUpload.css** (~400 lines)
   - Drag-drop zone
   - Progress bars
   - File preview
   - Error messages
   - Responsive design

4. **AnnouncementFeedWithInteractions.css** (~300 lines)
   - Post card layout
   - Header styling
   - Loading/error states
   - Responsive design

---

## üîÑ Data Flow

```
User Action
    ‚îÇ
    ‚ñº
Component Handler (e.g., handleReactionChange)
    ‚îÇ
    ‚îú‚îÄ Check Permission (usePermissions)
    ‚îÇ
    ‚îú‚îÄ Update UI Optimistically (setAnnouncements)
    ‚îÇ
    ‚ñº
Call API Service (postInteractionService)
    ‚îÇ
    ‚îú‚îÄ Send Request to Backend
    ‚îÇ
    ‚ñº
Update State with Response
    ‚îÇ
    ‚îú‚îÄ On Error: Reload from backend
    ‚îÇ
    ‚ñº
Display Updated UI
```

---

## üì± Responsive Design

T·∫•t c·∫£ components ƒë∆∞·ª£c optimize cho:
- Desktop (1024px+)
- Tablet (768px - 1023px)
- Mobile (< 768px)

**Breakpoints**:
- `@media (max-width: 768px)` - Tablet
- `@media (max-width: 480px)` - Mobile

---

## üîÑ State Management

**Hierarchical State**:

```
AnnouncementFeedWithInteractions (Container)
  ‚îú‚îÄ‚îÄ announcements[] (Posts + Comments)
  ‚îú‚îÄ‚îÄ loading
  ‚îú‚îÄ‚îÄ error
  ‚îî‚îÄ‚îÄ selectedPostForMedia (for media upload)
        ‚îÇ
        ‚îî‚îÄ‚îÄ usePostInteractions (per post)
             ‚îú‚îÄ‚îÄ reactions{}
             ‚îú‚îÄ‚îÄ comments[]
             ‚îú‚îÄ‚îÄ userReaction
             ‚îî‚îÄ‚îÄ isLiked
```

---

## üß™ Testing Examples

### Test Reaction Toggle
```javascript
const { handleReactionChange } = //...
await handleReactionChange('post_1', 'LIKE', false);
// Verify: reactions.LIKE includes userId
// Verify: userReaction === 'LIKE'
```

### Test Comment Add
```javascript
const { handleAddComment } = //...
await handleAddComment('post_1', 'Great post!', []);
// Verify: comments length increased
// Verify: new comment in list
```

### Test Permission
```javascript
const permissions = usePermissions('STUDENT', 'user_1');
expect(permissions.canDeleteComment()).toBe(false); // Student can't delete others' comments
expect(permissions.canLike()).toBe(true);
```

---

## üöÄ Integration Guide

### 1. Import Components
```javascript
import PostInteraction from './components/PostInteraction';
import CommentSection from './components/CommentSection';
import MediaUpload from './components/MediaUpload';
import { usePermissions } from './utils/rolePermissions';
import postInteractionService from './services/postInteractionService';
```

### 2. Use in Your Component
```javascript
const { canLike, canComment } = usePermissions(userRole, userId);

// In render:
<PostInteraction
  post={post}
  onReactionChange={handleReactionChange}
  isTeacher={isTeacher}
  canInteract={true}
/>

<CommentSection
  comments={comments}
  onAddComment={handleAddComment}
  currentUserRole={userRole}
/>
```

### 3. Connect to Backend
Update `postInteractionService.js`:
```javascript
// Change baseURL to your backend
this.baseURL = process.env.REACT_APP_API_URL || 'http://localhost:8080/api';

// Update endpoints to match your API
// Example: POST /api/posts/{postId}/reactions
```

---

## ‚öôÔ∏è Configuration

### Environment Variables
```
REACT_APP_API_URL=http://localhost:8080/api
REACT_APP_MAX_FILE_SIZE=10485760  # 10MB
REACT_APP_MAX_FILES=5
```

### Default Settings
```javascript
// In MediaUpload.jsx
const DEFAULT_MAX_FILES = 5;
const DEFAULT_MAX_SIZE = 10 * 1024 * 1024; // 10MB
const ALLOWED_TYPES = [
  'image/jpeg',
  'image/png',
  'image/gif',
  'video/mp4',
  'video/webm',
];
```

---

## üêõ Debugging

### Enable Verbose Logging
```javascript
// In postInteractionService.js
const DEBUG = process.env.REACT_APP_DEBUG === 'true';

if (DEBUG) {
  console.log('API Request:', method, endpoint);
  console.log('Response:', response);
}
```

### Common Issues

**Issue**: Comments not showing
- **Fix**: Check `isCommentLocked` flag on post

**Issue**: Media not uploading
- **Fix**: Verify file size < maxFileSize, type in allowedTypes

**Issue**: Permission denied
- **Fix**: Check user role with `usePermissions`, verify in permission matrix

---

## üìö Reference

- React Hooks: https://reactjs.org/docs/hooks-intro.html
- Lucide Icons: https://lucide.dev/
- FormData API: https://developer.mozilla.org/en-US/docs/Web/API/FormData
- Fetch API: https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API

---

## üìù Version History

**v1.0.0** (Current)
- Initial release
- 8 emoji reactions
- Nested comments with replies
- Media upload with validation
- Teacher controls (pin, lock, delete)
- Role-based permissions
- Responsive design

---

## üí° Future Enhancements

- [ ] Real-time notifications via WebSocket
- [ ] Emoji search/filter in picker
- [ ] Rich text editor for comments
- [ ] Mention system (@username)
- [ ] Hashtag support
- [ ] Comment threading depth limit
- [ ] Analytics dashboard for teachers
- [ ] Offensive content detection (AI)
- [ ] Comment archive/history
- [ ] Batch moderation actions

---

## üìû Support

ƒê·ªÉ b√°o c√°o l·ªói ho·∫∑c y√™u c·∫ßu t√≠nh nƒÉng, vui l√≤ng li√™n h·ªá:
- Email: support@upnest.edu
- GitHub Issues: https://github.com/upnest/education-platform/issues
